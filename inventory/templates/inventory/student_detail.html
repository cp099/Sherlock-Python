<!-- sherlock-python/inventory/templates/inventory/student_detail.html -->

{% extends "inventory/base.html" %}

{% block content %}
    <p><a href="{% url 'inventory:student_list' %}">< See all students</a></p>
    <h1>{{ student.name }}</h1>

    <div class="detail-container">
        <table class="open-table">
            <thead>
                <tr><th>Parameter</th><th>Value</th></tr>
            </thead>
            <tbody>
                <tr><td>Name</td><td>{{ student.name }}</td></tr>
                <tr><td>Admission Number</td><td>{{ student.admission_number }}</td></tr>
                <tr><td>Class</td><td>{{ student.student_class }}</td></tr>
                <tr><td>Section</td><td>{{ student.section }}</td></tr>
            </tbody>
        </table>

        <div class="action-area">
            <a href="{% url 'inventory:student_update' student.id %}">Edit Student Record</a>
        </div>
        
        <!-- === LOAN HISTORY SECTION === -->
        <h2>Items Currently on Loan</h2>
        {% if items_on_loan %}
            <table class="open-table">
                <thead>
                    <tr><th>Item</th><th>Quantity</th><th>Checked Out</th><th>Due Date</th></tr>
                </thead>
                <tbody>
                    {% for log in items_on_loan %}
                    <tr>
                        <td><a href="{{ log.item.get_absolute_url }}">{{ log.item.name }}</a></td>
                        <td>{{ log.quantity }}</td>
                        <td>{{ log.checkout_date }}</td>
                        <td>{{ log.due_date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>This student has no items currently on loan.</p>
        {% endif %}

        <h2 style="margin-top: 2em;">Full Loan History</h2>
        {% if loan_history %}
            <table class="open-table">
                <thead>
                    <tr><th>Item</th><th>Quantity</th><th>Checked Out</th><th>Returned On</th></tr>
                </thead>
                <tbody>
                    {% for log in loan_history %}
                    <tr>
                        <td><a href="{{ log.item.get_absolute_url }}">{{ log.item.name }}</a></td>
                        <td>{{ log.quantity }}</td>
                        <td>{{ log.checkout_date }}</td>
                        <td>{{ log.return_date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>This student has not returned any items yet.</p>
        {% endif %}

        {% if request.user.profile.role == 'ADMIN' %}
            <h2 class="destructive">Delete this student</h2>
            <form action="{% url 'inventory:student_delete' student.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="destructive-background" onclick="return confirm('Are you sure you want to delete this student record? This action is irreversible.');">
                    I understand, delete this student
                </button>
            </form>
        {% endif %}
    </div>
{% endblock %}